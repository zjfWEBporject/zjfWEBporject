<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Tesla</title>
		<link rel="icon" href="../picture/icon.png" type="icon">
		<link rel="stylesheet" type="text/css" href="../Tesla-css/emovaleffect.css"/>
		<link rel="stylesheet" type="text/css" href="../Tesla-css/style.css"/>
		<link rel="stylesheet" type="text/css" href="../Tesla-css/findus.css"/>
		<script src="../Tesla-js/jquery.js"></script>
		<script type="text/javascript"src="https://api.map.baidu.com/api?v=2.0&ak=2COzFaICuIyVj7V3VetKfmdRVnX8BhVr"></script>
	</head>
	<body>
		<!-- 头部导航栏 -->
		<div class="headnavigationbar">
			<a href="../index.html" class="logo"><img src="../picture/tslsvg.svg" alt="Tesla"></a>
			<ul class="model">
				<a href="./model-x.html">MODEL S</a>
				<a href="./model-3.html">MODEL 3</a>
				<a href="./model-x.html">MODEL X</a>
				<a href="./model-y.html">MODEL Y</a>
				<a href="./cybertruck.html">CYBERTRUCK</a>
				<a href="./powerwall.html">POWERWALL</a>
			</ul>
			<div class="onlinestore">
				<a href="./onlinestore.html" >在线商店</a>
				<a href="./signin.html" >TESLA 账户</a>
			</div>
			<div class="clicksidebar">
				<div class="sidebartop"></div>
				<div class="sidebarcenter"></div>
				<div class="sidebarbottom"></div>
			</div>
			<!-- 侧边栏 -->
			<div class="sidebar">
				<a href="./usedcar.html">认证二手车</a>
				<a href="./vehiclereplacement.html">车辆置换</a>
				<a href="./roadster.html">ROADSTER</a>
				<a href="./energy.html">ENERGY</a>
				<a href="./keyaccountplan.html">大客户计划</a>
				<a href="./finance.html">金融服务</a>
				<a href="./howtocharge.html">如何充电</a>
				<a href="./findus.html">找到我们</a>
				<a href="./questionsanswers.html">回答问题</a>
				<a href="./onlinestore.html">在线商店</a>
			</div>
			<div class="cylidg">立即订购</div>
			<div class="greycloth"></div>
		</div>
		
		<div class="w1150">
		    <div class="video-wrapper" >
		        <div class="map-top clearfix">
		            <div class="location-cur-pos js-cur-position">
		                <span class="location-col-red" id="location-name">【重庆】</span> 附近共有<span class="location-col-red" id="store-num">0</span>体验店</div>
		            <div class="location-section form-section js-location-select clearfix">
		                <div class="xm-select" style="float: left;">
		                    <div class="dropdown">
		                        <label class="iconfont" for="city">∨</label>
		                        <select id="province" class="js-province" name="addr_province">
		                            <option value="辽宁省">辽宁省</option>
		                            <option value="北京市">北京市</option>
		                            <option value="天津市">天津市</option>
		                            <option value="山西省">山西省</option>
		                            <option value="河北省">河北省</option>
		                            <option value="山东省">山东省</option>
		                            <option value="上海市">上海市</option>
		                            <option value="江苏省">江苏省</option>
		                            <option value="浙江省">浙江省</option>
		                            <option value="安微省">安微省</option>
		                            <option value="重庆市">重庆市</option>
		                            <option value="贵州省">贵州省</option>
		                            <option value="四川省">四川省</option>
		                            <option value="河南省">河南省</option>
		                            <option value="福建省">福建省</option>
		                            <option value="湖北省" selected="selected">湖北省</option>
		                            <option value="湖南省">湖南省</option>
		                            <option value="江西省">江西省</option>
		                            <option value="广东省">广东省</option>
		                            <option value="广西壮族自治区">广西壮族自治区</option>
		                            <option value="陕西省">陕西省</option>
		                            <option value="甘肃省">甘肃省</option>
		                            <option value="内蒙古自治区">内蒙古自治区</option>
		                            <option value="新疆维吾尔自治区">新疆维吾尔自治区</option>
		                            <option value="青海省">青海省</option>
		                            <option value="安徽省">安徽省</option>
		                            <option value="广西省">广西省</option>
		                            <option value="海南省">海南省</option>
		                            <option value="黑龙江">黑龙江</option>
		                            <option value="重庆">重庆</option>
		                            <option value="新疆省">新疆省</option>
		                            <option value="福建">福建</option>
		                        </select>
		                    </div>
		                </div>
		            </div>
		        </div>
		        <div class="location-main">
		            <div class="fl location-shop-con">
		                <div class="search-box">
		                    <input class="search-input" id="search_box_input" type="text" placeholder="请输入要检索的线下销售网点信息">
		                    <span class="search-icon"></span>
		                </div>
		                <div class="location-shop-detail">
		                    <ul class="location-list js-store" id="store-list" style="height:80vh;overflow: scroll">
		                    </ul>
		                    <div class="xm-controls xm-controls-small js-pager-controls" page="1" style="float: left;">
		                    </div>
		                </div>
		            </div>
		            <div class="location-map">
		                <div id="container" style="width: 100%; height: 100%; overflow: hidden; position: relative; z-index: 0; background-color: rgb(243, 241, 236); color: rgb(0, 0, 0); text-align:left;">
		                </div>
		            </div>
		        </div>
		    </div>
		</div>
		
		
		
		<script src="../Tesla-js/findus.js"></script>
		<script>
		    var map = new BMap.Map("container");          // 创建地图实例     // 初始化地图，设置中心点坐标和地图级别
		    map.centerAndZoom("深圳",15);
		    map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
		    map.addControl(new BMap.NavigationControl());
		    map.addControl(new BMap.NavigationControl());
		    map.addControl(new BMap.ScaleControl());
		    map.addControl(new BMap.OverviewMapControl());
		    map.addControl(new BMap.MapTypeControl());
		    $(function(){
		        getNowPos();
				getLocal("province="+provinceName);
				var provinceName=$("#province").val();
				//省市下拉框查找网点
		        $("#province").change(function(){
		            var provinceName=$(this).val();
		            $("#location-name").html("【"+provinceName+"】");
		            getLocal("province="+provinceName);
		        })
				
		      //根据门店的名称查找网点
		       $("span.search-icon").click(function(){
		            var content=$("#search_box_input").val();
		            if(content==""){
		                alert("请输入线下销售网点的信息");
		                return false;
		            }
		            getLocal("content="+content);
		        })
		    });
		
		    //搜索框按键查询
		    $(document).keyup(function (e) {//捕获文档对象的按键弹起事件
		        if (e.keyCode == 13) {//按键信息对象以参数的形式传递进来了
		            //此处编写用户敲回车后的代码
		            $("span.search-icon").click();
		        }
		    });
		
		
		    function getNowPos(){
		        var geolocation = new BMap.Geolocation();
		        geolocation.getCurrentPosition(function(r){
		            if(this.getStatus() == BMAP_STATUS_SUCCESS){
		                var mk = new BMap.Marker(r.point);
		                map.addOverlay(mk);//标出所在地
		                map.panTo(r.point);//地图中心移动
		                var point = new BMap.Point(r.point.lng,r.point.lat);//用所定位的经纬度查找所在地省市街道等信息
		                var gc = new BMap.Geocoder();
		                gc.getLocation(point, function(rs){
		                    var addComp = rs.addressComponents;
		                    $("#location-name").html("【"+addComp['province']+"】");
		                    $("#province option[value='"+addComp['province']+"']").attr("selected", true);
		                    getLocal("province="+addComp['province']);
		                });
		            }else {
		                alert('failed'+this.getStatus());
		            }
		        },{enableHighAccuracy: true})
		    }
		
		    var marker;
		    function getLocal(urlData){
		        //Ajax.call('/Marketing2.php?act=getlocal',urlData,returnToCartResponse,'POST', 'TEXT', true, true);
		        //function  returnToCartResponse(result){
				    result=[{"id":"515","province":"\u6e56\u5317\u7701","area":"\u5b9c\u660c","shopname":"特斯拉(重庆万象城体验中心)","shopaddr":"重庆市九龙坡谢家湾正街55号万象城LG层193号店铺","location":"106.521889,29.594534"},{"id":"516","province":"\u6e56\u5317\u7701","area":"\u6b66\u6c49","shopname":"重庆人和特斯拉中心","shopaddr":"重庆市渝北区香锦路6号","location":"106.54041,29.40268"},{"id":"517","province":"\u6e56\u5317\u7701","area":"\u6b66\u6c49","shopname":"特斯拉","shopaddr":"重庆市九龙坡区石新路2号附64-80号附近","location":"106.460686,29.518034"},{"id":"518","province":"\u6e56\u5317\u7701","area":"\u8944\u9633","shopname":"重庆南岸特斯拉中心","shopaddr":"重庆市南岸区南坪丹路78号","location":"106.586014,29.53694"},{"id":"519","province":"\u6e56\u5317\u7701","area":"\u5341\u5830","shopname":"重庆汇金特斯拉中心","shopaddr":"重庆市渝北区汇金路3号","location":"106.54041,29.40268"},{"id":"520","province":"\u6e56\u5317\u7701","area":"\u6069\u65bd","shopname":"特斯拉超级充电站(重庆财富大厦)","shopaddr":"重庆市渝北区洪湖东路9号","location":"106.509163,29.608332"},{"id":"521","province":"\u6e56\u5317\u7701","area":"\u8346\u5dde","shopname":"特斯拉超级充电站(重庆市佳宇英皇酒店站)","shopaddr":"重庆市九龙坡区杨家坪直港大道206号","location":"106.530548,29.504911"},{"id":"522","province":"\u6e56\u5317\u7701","area":"\u76d1\u5229","shopname":"特斯拉超级充电站(重庆国瑞中心)","shopaddr":"重庆市南岸区烟雨路9号国瑞中心地下停车场B3层A区","location":"106.586334,29.536982"}];
		            result1=eval(result); 		
		            reg=eval(result); 
		            if(reg.length<1){
		                $("#store-list").children().remove();
		                $("#store-list").append("<div style='text-align: center;line-height: 50px;'>暂无搜索的网点</div>");
		                return false;
		            }
		            var storeList="";
		            $("#store-num").html(reg.length);
		            map.clearOverlays();
		            var pointsView = [];
		            for(var i=0;i<reg.length;i++){
		                var n=i+1;
		                var p= reg[i]['location'].split(',');
		                var point = new BMap.Point(p[0],p[1]);
		                pointsView.push(point);
						
		                var content ="<p style='font-weight:600'>"+reg[i].shopname+"</p><p style='line-height: 20px;'>地址："+reg[i].shopaddr+"</p>";
		                var myIcon = new BMap.Icon("../picture/bd1.png", new BMap.Size(21, 33), {
		                    offset: new BMap.Size(10, 25), // 指定定位位置
		                });
		                var  marker = new BMap.Marker(point,{icon:myIcon});        // 创建标注
		                var label = new BMap.Label(n,{
		                    offset : new BMap.Size(0,3)
		                });
		                label.setStyle({
		                    width:'21px',background:'none',color:'#fff',border:'none',textAlign:'center'//只要对label样式进行设置就可达到在标注图标上显示数字的效果
		                });
		                marker.setLabel(label);//显示地理名称 a
		                map.addOverlay(marker);
		                addClickHandler(content,marker);
						
		                storeList+='<li onclick="to(this,'+i+','+p[0]+','+p[1]+',\''+reg[i].shopname+'\',\''+reg[i].shopaddr+'\')"><span class="location-num">'+n+'</span><div class="location-addr">'
		                +'<h3>'+reg[i].shopname+'</h3> <p class="addr-info">'+reg[i].shopaddr+'</p></div>'
		                +'</li>';
		            }
		            //让所有点在视野范围内
		            map.setViewport(pointsView);
		            $("#store-list").children().remove();
		            $("#store-list").append(storeList);
		       // }
		    }
		
		    var opts = {
		        width : 250,     // 信息窗口宽度
		        height: 50,     // 信息窗口高度
		        title : "" , // 信息窗口标题
		        enableMessage:true//设置允许信息窗发送短息
		    };
		
		
		    //点击将信息内容加入白标注中
		    function addClickHandler(content,marker){
		        marker.addEventListener("click",function(e){
		                    marker.setAnimation(null);
		                    openInfo(content,e);
		                }
		        );
		    }
		
		    function openInfo(content,e){
		        var p = e.target;
		        var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
		        var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象
		        map.openInfoWindow(infoWindow,point); //开启信息窗口
		    }
		
		    //移动到某一坐标点
		    function to(obj,i,x,y,shopname,shopaddr){
		        var allOverlay = map.getOverlays();
		        var last=allOverlay.length-1;
		        map.removeOverlay(allOverlay[last]);
		        $(obj).addClass("addMove");
		        $(obj).siblings().removeClass("addMove");
		        var point=new BMap.Point(x,y);
		        map.centerAndZoom(point,15);
		        var myIcon = new BMap.Icon("../picture/bd2.png", new BMap.Size(21, 33), {
		            offset: new BMap.Size(10, 25), // 指定定位位置
		        });
		        var  marker = new BMap.Marker(point,{icon:myIcon});        // 创建标注
		        var n=i+1;
		        var label = new BMap.Label(n,{
		            offset : new BMap.Size(0,3)
		        });
		        label.setStyle({
		            width:'21px',background:'none',color:'#fff',border:'none',textAlign:'center'//只要对label样式进行设置就可达到在标注图标上显示数字的效果
		        });
		        marker.setLabel(label);//显示地理名称 a
		        map.addOverlay(marker);
		        var content ="<p style='font-weight:600'>"+shopname+"</p><p style='line-height: 20px;'>地址："+shopaddr+"</p>";
		        addClickHandler(content,marker);
		    }
		</script>
	</body>
</html>
